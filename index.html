<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Team Distributor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Random Team Distributor</h1>

        <div>
            <label for="csvInput">Upload CSV File:</label>
            <input type="file" id="csvInput" accept=".csv">
        </div>

        <div>
            <label for="numMembers">Number of Members:</label>
            <input type="number" id="numMembers" min="1">
            <button id="generateInputs">Generate Member Inputs</button>
        </div>

        <div id="memberInputs"></div>

        <div>
            <label for="numTeams">Number of Teams:</label>
            <input type="number" id="numTeams" min="1" required>
        </div>

        <button id="distributeBtn" style="display:none;">Distribute Members</button>
        <button id="downloadBtn" style="display:none;">Download CSV</button>

        <div id="result" class="result"></div>
    </div>

    <script>
        let teams = [];
        let members = [];

        // Handle CSV file upload
        document.getElementById('csvInput').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const text = e.target.result;
                    members = parseCSV(text);
                    alert(`Loaded ${members.length} members from CSV.`);
                    clearMemberInputs();
                    document.getElementById('distributeBtn').style.display = 'block';
                };
                reader.readAsText(file);
            }
        });

        function parseCSV(text) {
            const lines = text.split('\n');
            return lines.map(line => line.trim()).filter(line => line);
        }

        // Generate input fields for manual member input
        document.getElementById('generateInputs').addEventListener('click', () => {
            const numMembers = parseInt(document.getElementById('numMembers').value);
            const memberInputsDiv = document.getElementById('memberInputs');
            memberInputsDiv.innerHTML = '';

            for (let i = 0; i < numMembers; i++) {
                memberInputsDiv.innerHTML += `
                    <label for="member${i}">Member ${i + 1} Name:</label>
                    <input type="text" id="member${i}" required>
                `;
            }
            document.getElementById('distributeBtn').style.display = 'block';
        });

        // Distribute members into teams
        document.getElementById('distributeBtn').addEventListener('click', () => {
            const numTeams = parseInt(document.getElementById('numTeams').value);
            if (members.length === 0) {
                for (let i = 0; i < document.getElementById('numMembers').value; i++) {
                    members.push(document.getElementById(`member${i}`).value);
                }
            }

            const shuffledMembers = members.sort(() => 0.5 - Math.random());
            teams = Array.from({ length: numTeams }, () => []);

            shuffledMembers.forEach((member, index) => {
                const teamIndex = index % numTeams;
                teams[teamIndex].push(member);
            });

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '';

            teams.forEach((team, index) => {
                resultDiv.innerHTML += `<strong>Team ${index + 1}:</strong> ${team.join(', ')}<br>`;
            });

            document.getElementById('downloadBtn').style.display = 'block';
        });

        // Download the results as a CSV file
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const csvContent = "data:text/csv;charset=utf-8," 
                + teams.map((team, index) => `Team ${index + 1}, ${team.join(', ')}`).join('\n');
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', 'team_distribution.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Clear member input fields
        function clearMemberInputs() {
            const memberInputsDiv = document.getElementById('memberInputs');
            memberInputsDiv.innerHTML = '';
            document.getElementById('numMembers').value = '';
        }
    </script>
</body>
</html>
